<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="nl">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
		<title>MLR (Measure of Lexical Richness, versie 0.99b)</title>

		<script type="text/javascript" src="js/jquery-3.2.1.min.js"></script>
		<script type="text/javascript" src="js/removeDiacritics.js"></script>
		<script type="text/javascript" src="js/mlr.js"></script>

		<link href="bootstrap/css/bootstrap.min.css" rel="stylesheet">
		<script src="bootstrap/js/bootstrap.min.js"></script>

		<script type="text/javascript">
			$(function() {
				$('span[data-toggle="tooltip"]').tooltip(); 
				
				$('#input').on('input', function() {
					t = new Text($(this).val(), mlr);
					t.autoSelectLowestFactors(mlr);
					s = t.generateMlrStats(mlr);
					
					updateUI();
				});
				
				// whenever debug window is opened, update the data
				$('#debug_show').on('click', function() {
					if (!$("#debugGroupContent").is(":visible")) {
						$('#debug_mlr_version code').text(JSON.stringify(mlr.version, undefined, 4));
						$('#debug_tokens pre').text(JSON.stringify(mlr.tokens, undefined, 4));
						$('#debug_lemmas pre').text(JSON.stringify(mlr.lemmas, undefined, 4));
						var issues = DataIssues(mlr);
						$('#debug_dataq ul').empty();
						if (issues.length > 0) {
							for (index = 0; index < issues.length; ++index) {
								$('#debug_dataq ul').append($('<li>').text(issues[index]));
							}
						} else {
							$('#debug_dataq ul').append($('<li>').text("Geen problemen gevonden."));
						}
						try {
							$('#debug_statistics pre').text(JSON.stringify(s, undefined, 4));
							$('#debug_text pre').text(JSON.stringify(t, undefined, 4)); 
						} catch(err) {}
					}
				});
			});
			
			var updateUI = function() {
				for (var i in Object.keys(s.lists)) {
					var index = Object.keys(s.lists)[i];
					$("#percentage_"+index+" .token.count").text(s.lists[index]["totalTokens"] || "");
					$("#percentage_"+index+" .token.percent").text(s.lists[index]["percentageOfTotalTokens"]> 0 ? s.lists[index]["percentageOfTotalTokens"].toFixed(2) : "");
					$("#percentage_"+index+" .token.cumulative").text(s.lists[index]["cumulativePercentageOfTotalTokens"] > 0 ? s.lists[index]["cumulativePercentageOfTotalTokens"].toFixed(2) : "");
					$("#percentage_"+index+" .lemma.count").text(s.lists[index]["totalLemmas"] || "");
					$("#percentage_"+index+" .lemma.percent").text(s.lists[index]["percentageOfTotalTokens"] > 0 ? s.lists[index]["percentageOfTotalLemmas"].toFixed(2) : "");
					$("#percentage_"+index+" .lemma.cumulative").text(s.lists[index]["cumulativePercentageOfTotalLemmas"] > 0 ? s.lists[index]["cumulativePercentageOfTotalLemmas"].toFixed(2) : "");
				}
				if ($("#input").val()) {
					$('#mlr').text(s.mlr.toFixed(2));
					$('#vocab').text((s.mlr*1000).toFixed(0));
					$('#mlrGroup').show(400);
				} else {
					$('#mlrGroup').hide(400);
				}

				// if tokens breakdown is shown, update them.
				if ($("#tokensGroupContent").is(":visible")) {
					$("#tokenListTarget").empty();
					for (index = 0; index < t.tokenlist.length; ++index) {
						$("#tokenListTarget").append($("#tokenTemplate").clone().prop("id", "token"+index));
						$("#token"+index+" button").text(t.tokenlist[index].t);
						$("#token"+index+" a").prop("token", index);
						
						for (j = 0; t.tokenlist[index].lemmas && j < t.tokenlist[index].lemmas.length; ++j) {
							$("#token"+index+" ul").prepend($("#selectLemmaForTokenTemplate").clone().prop("id", "selectLemma"+j+"ForToken"+index));
							$("#selectLemma"+j+"ForToken"+index+" a").text(t.tokenlist[index].lemmas[j]).prop("lemma", j).prop("token", index);
							if (t.tokenlist[index].selected == j) { $("#selectLemma"+j+"ForToken"+index+" a").addClass("btn-info"); }
						}
						
						if (!t.tokenlist[index].ignore) {
							if (!mlr.lemmas[t.tokenlist[index].getSelectedLemma()] > 0) {
								$("#token"+index+" button"). addClass("btn-warning");
							} else {
								$("#token"+index+" button").addClass("btn-default");
							}
						} else {
							$("#token"+index+" .ignore-token").addClass("btn-info");
						}
					}
				}

				// if lemma lists are shown, update them.
				if ($("#lemmasGroupContent").is(":visible")) {
					$("#lemmaListTarget").empty();
					for (var i in Object.keys(s.lists)) {
						var index = Object.keys(s.lists)[i];
						if (index != "known" && index != "total" && s.lists[index].totalLemmas > 0) {
							$("#lemmaListTarget").append($("#lemmaListTemplate").clone().prop("id", "lemmaList"+index));
							$("#lemmaList"+index+" caption").text("Lijst "+index);
							$("#lemmaList"+index+" tbody").prop("id", "lemmaListRowTarget"+index).empty();
							var lemmas = Object.keys(s.lists[index].lemmas).sort(function(a,b){return s.lists[index].lemmas[b].length - s.lists[index].lemmas[a].length});
							for (var j = 0; j < lemmas.length; ++j) {
								var lemma = lemmas[j];
								$("#lemmaListRowTarget"+index).append($("#lemmaListRowTemplate").clone().prop("id", "lemmaList"+index+"Row"+j));
								$("#lemmaList"+index+"Row"+j+" td:nth-child(1)").text(lemma);
								$("#lemmaList"+index+"Row"+j+" td:nth-child(2)").text(s.lists[index].lemmas[lemma].length);
							}
						}
					}
				}
				
				// if debug information is shown, update it.
				if ($("#debugGroupContent").is(":visible")) {
					$('#debug_statistics pre').text(JSON.stringify(s, undefined, 4));
					$('#debug_text pre').text(JSON.stringify(t, undefined, 4));
				}
			}

			var ignoreToken = function(e) {
				t.tokenlist[($(e).prop("token"))].ignore = !t.tokenlist[($(e).prop("token"))].ignore;
				s = t.generateMlrStats(mlr);
				
				updateUI();
			}
			
			var ignoreAllToken = function(e) {
				var token = t.tokenlist[($(e).prop("token"))].t;
				for (index = 0; index < t.tokenlist.length; ++index) {
					if (t.tokenlist[index].t == token) {
						t.tokenlist[index].ignore = true;
					}
				}
				s = t.generateMlrStats(mlr);
				
				updateUI();
			}
			
			var selectLemmaForToken = function(e) {
				t.tokenlist[($(e).prop("token"))].setSelected(($(e).prop("lemma")));
				s = t.generateMlrStats(mlr);
				
				updateUI();
			}
		</script>
		<style>
			td:after {
				color: lightgrey;
			}
			.percent:after {
				content: "%";
			}
			.cumulative:after {
				content: "%";
			}
			td:empty:after {
				content: "-";
				display: block;
			}
			.pills-small li a {
				padding: 4px;
			}
			.token-button {
				margin: 2px;
			}
		</style>
	</head>
	<body>
		<div class="container">
			<h1>Measure of Lexical Richness <small>versie 0.99b</small></h1>
			<div class="alert alert-info alert-dismissible" role="alert">
				<button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>
				<strong>Welkom!</strong> Meer informatie over dit programma is te vinden op de projectpagina op <a href="https://github.com/lukasvermeer/mlr/blob/master/README.md" target="_blank" class="alert-link">Github.</a>
			</div>
			
			<div class="form-group">
				<label for="input">Vul of plak hier (liefst uit notepad, ivm rare codes en harde returns) uw tekst:</label>
				<textarea id="input" class="form-control" autofocus></textarea>
			</div>
			<p class="lead" style="display: none;" id="mlrGroup">MLR van deze tekst = <b id="mlr"></b> <small>(indicatie woordvoorraad <span id="vocab"></span> woorden)</small></p>
			<div>
				<div class="panel panel-default">
				  <table class="table table-striped" id="percentage">
				  	<caption>Lijstverdeling</caption>
					<thead>
						<tr>
							<th>Woordenlijst</th>
							<th><span data-toggle="tooltip" title="Het aantal tokens dat in deze lijst voorkomt.">Tokens</span></th>
							<th><span data-toggle="tooltip" title="Het percentage van alle tokens dat in deze lijst voorkomt.">Percentage</span></th>
							<th><span data-toggle="tooltip" title="Het cumulatieve percentage van alle tokens dat in deze of eerdere lijsten voorkomt.">Cumulatief</span></th>
							<th><span data-toggle="tooltip" title="Het aantal lemma's dat in deze lijst voorkomt.">Lemma's</span></th>
							<th><span data-toggle="tooltip" title="Het percentage van alle lemma's dat in deze lijst voorkomt.">Percentage</span></th>
							<th><span data-toggle="tooltip" title="Het cumulatieve percentage van alle lemma's dat in deze of eerdere lijsten voorkomt.">Cumulatief</span></th>
						</tr>
					</thead>
					<tbody>
						<tr id="percentage_1"><th scope="row">Lijst 1</th><td class="token count"></td><td class="token percent"></td><td class="token cumulative"></td><td class="lemma count"></td><td class="lemma percent"></td><td class="lemma cumulative"></td></tr>
						<tr id="percentage_2"><th scope="row">Lijst 2</th><td class="token count"></td><td class="token percent"></td><td class="token cumulative"></td><td class="lemma count"></td><td class="lemma percent"></td><td class="lemma cumulative"></td></tr>
						<tr id="percentage_3"><th scope="row">Lijst 3</th><td class="token count"></td><td class="token percent"></td><td class="token cumulative"></td><td class="lemma count"></td><td class="lemma percent"></td><td class="lemma cumulative"></td></tr>
						<tr id="percentage_4"><th scope="row">Lijst 4</th><td class="token count"></td><td class="token percent"></td><td class="token cumulative"></td><td class="lemma count"></td><td class="lemma percent"></td><td class="lemma cumulative"></td></tr>
						<tr id="percentage_5"><th scope="row">Lijst 5</th><td class="token count"></td><td class="token percent"></td><td class="token cumulative"></td><td class="lemma count"></td><td class="lemma percent"></td><td class="lemma cumulative"></td></tr>
						<tr id="percentage_6"><th scope="row">Lijst 6</th><td class="token count"></td><td class="token percent"></td><td class="token cumulative"></td><td class="lemma count"></td><td class="lemma percent"></td><td class="lemma cumulative"></td></tr>
						<tr id="percentage_7"><th scope="row">Lijst 7</th><td class="token count"></td><td class="token percent"></td><td class="token cumulative"></td><td class="lemma count"></td><td class="lemma percent"></td><td class="lemma cumulative"></td></tr>
						<tr id="percentage_8"><th scope="row">Lijst 8</th><td class="token count"></td><td class="token percent"></td><td class="token cumulative"></td><td class="lemma count"></td><td class="lemma percent"></td><td class="lemma cumulative"></td></tr>
						<tr id="percentage_9"><th scope="row">Lijst 9</th><td class="token count"></td><td class="token percent"></td><td class="token cumulative"></td><td class="lemma count"></td><td class="lemma percent"></td><td class="lemma cumulative"></td></tr>
						<tr id="percentage_known"><th scope="row">Totaal bekend</th><td class="token count"></td><td class="token percent"></td><td class="token cumulative"></td><td class="lemma count"></td><td class="lemma percent"></td><td class="lemma cumulative"></td></tr>
						<tr id="percentage_0" class="warning"><th scope="row">Onbekend</th><td class="token count"></td><td class="token percent"></td><td class="token cumulative"></td><td class="lemma count"></td><td class="lemma percent"></td><td class="lemma cumulative"></td></tr>
						<tr id="percentage_total"><th scope="row">Totaal</th><td class="token count"></td><td class="token percent"></td><td class="token cumulative"></td><td class="lemma count"></td><td class="lemma percent"></td><td class="lemma cumulative"></td></tr>
				  </table>
				</div>
			</div>

			<div class="panel-group">
				<div class="panel panel-default">
					<div class="panel-heading">Tokens</div>
					<div id="tokensGroupContent">
						<div class="panel-body">
							<div style="display:none;">
								<div class="btn-group token-button" id="tokenTemplate" role="group">
									<button class="btn dropdown-toggle" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
										Template
									</button>
									<ul class="dropdown-menu">
										<li id="selectLemmaForTokenTemplate"><a role="button" onClick="selectLemmaForToken(this)"></a></li>
										<li role="separator" class="divider"></li>

										<li><a role="button" onClick="ignoreToken(this)" class="ignore-token">Negeer</a></li>
										<li><a role="button" onClick="ignoreAllToken(this)">Negeer Allen</a></li>
									</ul>
								</div>
							</div>
							<div id="tokenListTarget"></div>
						</div>
					</div>
				</div>
			</div>

			<div class="panel-group">
				<div class="panel panel-default">
					<div class="panel-heading">Lemmalijsten</div>
					<div id="lemmasGroupContent">
						<div class="panel-body">
							<div style="display:none;">
								<table class="table table-striped" id="lemmaListTemplate">
									<caption>Template</caption>
									<thead>
										<tr>
											<th>Lemma</th>
											<th>Frequentie</th>
										</tr>
									</thead>
									<tbody>
										<tr id="lemmaListRowTemplate">
											<td class="lemma"></td>
											<td class="lemma count col-md-1"></td>
										</tr>
									</tbody>
								</table>
							</div>
							<div id="lemmaListTarget"></div>
						</div>
					</div>
				</div>
			</div>

			<p class="text-center"><small>Dit project wordt onderhouden op <a href="http://github.com/lukasvermeer/mlr">Github</a> door <a href="http://www.lukasvermeer.nl">Lukas Vermeer</a> en <a href="http://annevermeer.com/">Anne Vermeer</a>.</small></p>
			<div class="panel-group" id="debugGroup" role="tablist" aria-multiselectable="true">
				<div class="panel panel-default">
					<div class="panel-heading" role="tab" id="debugGroupHeading">
						<a id="debug_show" role="button" data-toggle="collapse" data-parent="#debugGroup" href="#debugGroupContent" aria-expanded="true" aria-controls="debugGroupContent">
							<small>Onderwaterscherm <span class="caret"></span></small>
						</a>
					</div>
					<div id="debugGroupContent" class="panel-collapse collapse" role="tabpanel" aria-labelledby="debugGroupContent">
						<div class="panel-body">
							<ul class="nav nav-pills pills-small nav-justified button-small" role="tablist">
								<li role="presentation" class="active"><a href="#debug_mlr_version" aria-controls="debug_mlr_version" role="tab" data-toggle="tab">Versie</a></li>
								<li role="presentation"><a href="#debug_tokens" aria-controls="debug_tokens" role="tab" data-toggle="tab">Tokens</a></li>
								<li role="presentation"><a href="#debug_lemmas" aria-controls="debug_lemmas" role="tab" data-toggle="tab">Lemmas</a></li>
								<li role="presentation"><a href="#debug_dataq" aria-controls="debug_dataq" role="tab" data-toggle="tab">Controle</a></li>
								<li role="presentation"><a href="#debug_text" aria-controls="debug_text" role="tab" data-toggle="tab">Tekst</a></li>
								<li role="presentation"><a href="#debug_statistics" aria-controls="debug_statistics" role="tab" data-toggle="tab">Statistieken</a></li>
							</ul>
							<br />
							<div class="tab-content">
								<div role="tabpanel" class="tab-pane fade in active" id="debug_mlr_version"><p>Het versienummer van de geladen MLR dataset is <code>FOUT</code>.</p></div>
								<div role="tabpanel" class="tab-pane fade" id="debug_tokens"><h4>Interne representatie van alle tokens in de geladen MLR dataset.</h4><pre></pre></div>
								<div role="tabpanel" class="tab-pane fade" id="debug_lemmas"><h4>Interne representatie van alle lemmas in de geladen MLR dataset.</h4><pre></pre></div>
								<div role="tabpanel" class="tab-pane fade" id="debug_dataq"><h4>Mogelijke problemen met de datakwaliteit van de geladen MLR dataset.</h4><ul class="list-unstyled"><code>FOUT BIJ UITVOEREN CONTROLE</code></ul></div>
								<div role="tabpanel" class="tab-pane fade" id="debug_text"><h4>Interne representatie van de ingevoerde tekst.</h4><pre></pre></div>
								<div role="tabpanel" class="tab-pane fade" id="debug_statistics"><h4>Interne representatie de statistieken op basis van de ingevoerde tekst.</h4><pre></pre></div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</body>
</html>
